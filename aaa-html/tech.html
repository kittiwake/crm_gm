<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Канбан доска заказов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }
        #sidebar {
            height: 100vh;
            position: fixed;
            width: 200px;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 15px;
            overflow-y: auto;
        }
        #content {
            margin-left: 200px;
            padding: 20px;
        }
        .order-item {
            padding: 10px;
            margin-bottom: 5px;
            background-color: #e9ecef;
            border-radius: 4px;
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
        }
        .order-item:hover {
            background-color: #dee2e6;
            transform: translateY(-2px);
        }
        .kanban-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        .kanban-header {
            display: flex;
            min-width: 800px;
        }
        .manager-header {
            flex: 1;
            min-width: 150px;
            background-color: #f1f3f5;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #dee2e6;
            border-right: none;
        }
        .manager-header:first-child {
            position: sticky;
            left: 0;
            z-index: 10;
            border-left: 1px solid #dee2e6;
        }
        .kanban-body {
            min-width: 800px;
        }
        .date-row {
            display: flex;
            min-height: 100px;
        }
        .date-cell {
            flex: 1;
            min-width: 150px;
            background-color: #f8f9fa;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-right: none;
        }
        .date-cell:first-child {
            position: sticky;
            left: 0;
            z-index: 9;
            background-color: #e9ecef;
            font-weight: bold;
            border-left: 1px solid #dee2e6;
        }
        .weekend {
            background-color: #f1f1f1 !important;
            color: #6c757d;
        }
        .task-card {
            background-color: white;
            padding: 8px;
            margin: 2px 0;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: move;
            font-size: 0.9rem;
            user-select: none;
        }
        .task-card.manager-assigned {
            border-left-color: #198754;
        }
        .task-card .manager {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 3px;
        }
        .no-drag {
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <!-- Сайдбар с заказами -->
    <div id="sidebar">
        <h5 class="mb-3">Заказы</h5>
        <div id="orders-list">
            <div class="order-item" data-order-id="1">Заказ 1</div>
            <div class="order-item" data-order-id="2">Заказ 2</div>
            <div class="order-item" data-order-id="3">Заказ 3</div>
            <div class="order-item" data-order-id="4">Заказ 4</div>
            <div class="order-item" data-order-id="5">Заказ 5</div>
            <div class="order-item" data-order-id="6">Заказ 6</div>
            <div class="order-item" data-order-id="7">Заказ 7</div>
            <div class="order-item" data-order-id="8">Заказ 8</div>
            <div class="order-item" data-order-id="9">Заказ 9</div>
            <div class="order-item" data-order-id="10">Заказ 10</div>
        </div>
    </div>

    <!-- Основное содержимое -->
    <div id="content">
        <h2>План реализации заказов</h2>
        <p class="text-muted">Перетащите заказ из сайдбара в нужную ячейку календаря</p>
        
        <!-- Канбан доска (столбцы - менеджеры, строки - даты) -->
        <div class="kanban-container">
            <!-- Заголовок с именами менеджеров -->
            <div class="kanban-header" id="kanban-header">
                <div class="manager-header">Дата</div>
                <!-- Столбцы для менеджеров будут добавлены динамически -->
            </div>
            
            <!-- Тело доски с датами -->
            <div class="kanban-body" id="kanban-body">
                <!-- Строки для дат будут добавлены динамически -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Определяем менеджеров
            const managers = [
                { id: 'ivan', name: 'Иван' },
                { id: 'maria', name: 'Мария' },
                { id: 'aleksey', name: 'Алексей' },
                { id: 'elena', name: 'Елена' }
            ];
            
            // Рассчитываем ширину столбца на основе количества менеджеров
            const columnWidth = Math.max(150, Math.floor((window.innerWidth - 200 - 150) / managers.length));
            
            // Генерация календаря на 5 рабочих дней
            function generateCalendar() {
                const today = new Date();
                const days = [];
                let currentDay = new Date(today);
                
                // Находим ближайший понедельник
                while (currentDay.getDay() !== 1) { // 1 = понедельник
                    currentDay.setDate(currentDay.getDate() + 1);
                }
                
                // Добавляем 5 рабочих дней
                for (let i = 0; i < 5; i++) {
                    const day = new Date(currentDay);
                    days.push(day);
                    currentDay.setDate(currentDay.getDate() + 1);
                }
                
                // Заполняем заголовок календаря (менеджеры)
                const header = document.getElementById('kanban-header');
                
                // Очищаем все столбцы менеджеров
                const managerHeaders = header.querySelectorAll('.manager-header:not(:first-child)');
                managerHeaders.forEach(header => header.remove());
                
                // Добавляем заголовки для каждого менеджера
                managers.forEach(manager => {
                    const th = document.createElement('div');
                    th.className = 'manager-header';
                    th.style.minWidth = `${columnWidth}px`;
                    th.dataset.managerId = manager.id;
                    th.textContent = manager.name;
                    header.appendChild(th);
                });
                
                // Заполняем тело таблицы
                const body = document.getElementById('kanban-body');
                body.innerHTML = '';
                
                // Заполняем строки для каждой даты
                days.forEach(day => {
                    const isWeekend = day.getDay() === 6 || day.getDay() === 0;
                    const dayClass = isWeekend ? 'weekend' : '';
                    const dayName = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'][day.getDay()];
                    const dayDate = `${day.getDate()}.${String(day.getMonth() + 1).padStart(2, '0')}`;
                    
                    const row = document.createElement('div');
                    row.className = 'date-row';
                    
                    // Ячейка с названием дня
                    const dateCell = document.createElement('div');
                    dateCell.className = `date-cell ${dayClass}`;
                    dateCell.style.minWidth = '150px';
                    dateCell.innerHTML = `<strong>${dayName}</strong><br><small>${dayDate}</small>`;
                    row.appendChild(dateCell);
                    
                    // Ячейки для каждого менеджера в этот день
                    managers.forEach(manager => {
                        const cell = document.createElement('div');
                        cell.className = `date-cell ${dayClass}`;
                        cell.style.minWidth = `${columnWidth}px`;
                        cell.dataset.manager = manager.id;
                        cell.dataset.date = day.toISOString().split('T')[0];
                        cell.dataset.dayName = dayName;
                        
                        // Создаем контейнер для задач
                        const taskContainer = document.createElement('div');
                        taskContainer.className = 'task-container';
                        cell.appendChild(taskContainer);
                        
                        // Блокируем перетаскивание в выходные дни
                        if (isWeekend) {
                            cell.classList.add('no-drag');
                        }
                        
                        row.appendChild(cell);
                    });
                    
                    body.appendChild(row);
                });
                
                return days;
            }
            
            // Инициализация календаря
            const workDays = generateCalendar();
            
            // Сделать заказы перетаскиваемыми
            document.querySelectorAll('.order-item').forEach(item => {
                item.setAttribute('draggable', 'true');
                
                item.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', `order-${this.dataset.orderId}`);
                    e.dataTransfer.effectAllowed = 'move';
                    
                    // Визуальный эффект для перетаскивания
                    setTimeout(() => {
                        this.classList.add('opacity-50');
                    }, 0);
                });
                
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('opacity-50');
                });
            });
            
            // Сделать ячейки календаря приемниками
            document.querySelectorAll('.date-cell:not(.weekend)').forEach(cell => {
                cell.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    this.style.backgroundColor = '#e7f3ff';
                });
                
                cell.addEventListener('dragleave', function(e) {
                    this.style.backgroundColor = '';
                });
                
                cell.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    const data = e.dataTransfer.getData('text/plain');
                    if (data.startsWith('order-')) {
                        const orderId = data.replace('order-', '');
                        const managerId = this.dataset.manager;
                        const managerName = getManagerName(managerId);
                        const date = this.dataset.date;
                        const dayName = this.dataset.dayName;
                        
                        // Форматируем дату
                        const dateObj = new Date(date);
                        const formattedDate = `${String(dateObj.getDate()).padStart(2, '0')}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${dateObj.getFullYear()}`;
                        
                        // Создаем карточку задачи
                        const task = document.createElement('div');
                        task.className = 'task-card manager-assigned';
                        task.dataset.orderId = orderId;
                        task.dataset.manager = managerId;
                        task.dataset.date = date;
                        task.setAttribute('draggable', 'true');
                        
                        task.innerHTML = `
                            Заказ #${orderId}
                            <div class="manager">Менеджер: ${managerName}, ${dayName} ${formattedDate}</div>
                        `;
                        
                        // Добавляем возможность перетаскивания задачи
                        task.addEventListener('dragstart', function(e) {
                            e.dataTransfer.setData('text/plain', `task-${orderId}`);
                            e.dataTransfer.effectAllowed = 'move';
                            setTimeout(() => {
                                this.classList.add('opacity-50');
                            }, 0);
                        });
                        
                        task.addEventListener('dragend', function(e) {
                            this.classList.remove('opacity-50');
                        });
                        
                        // Добавляем задачу в ячейку
                        this.querySelector('.task-container').appendChild(task);
                        
                        // Удаляем оригинал из сайдбара
                        const orderItem = document.querySelector(`.order-item[data-order-id="${orderId}"]`);
                        if (orderItem) {
                            orderItem.remove();
                        }
                    }
                    else if (data.startsWith('task-')) {
                        // Перемещение существующей задачи
                        const orderId = data.replace('task-', '');
                        const managerId = this.dataset.manager;
                        const managerName = getManagerName(managerId);
                        const date = this.dataset.date;
                        const dayName = this.dataset.dayName;
                        
                        // Форматируем дату
                        const dateObj = new Date(date);
                        const formattedDate = `${String(dateObj.getDate()).padStart(2, '0')}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${dateObj.getFullYear()}`;
                        
                        // Находим оригинальную задачу и перемещаем ее
                        const task = document.querySelector(`.task-card[data-order-id="${orderId}"]`);
                        if (task) {
                            task.querySelector('.manager').textContent = 
                                `Менеджер: ${managerName}, ${dayName} ${formattedDate}`;
                            task.dataset.manager = managerId;
                            task.dataset.date = date;
                            this.querySelector('.task-container').appendChild(task);
                        }
                    }
                });
            });
            
            // Вспомогательная функция для получения имени менеджера по ID
            function getManagerName(managerId) {
                const managers = {
                    'ivan': 'Иван',
                    'maria': 'Мария',
                    'aleksey': 'Алексей',
                    'elena': 'Елена'
                };
                return managers[managerId] || managerId;
            }
            
            // Обработка изменения размера окна
            window.addEventListener('resize', function() {
                const newColumnWidth = Math.max(150, Math.floor((window.innerWidth - 200 - 150) / managers.length));
                document.querySelectorAll('.manager-header:not(:first-child), .date-cell:not(:first-child)').forEach(el => {
                    el.style.minWidth = `${newColumnWidth}px`;
                });
            });
        });
    </script>
</body>
</html>